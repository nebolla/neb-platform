version: 1.0
runtime: nodejs22

build:
  commands:
    build:
      - corepack enable && pnpm --version || true
      - pnpm -C apps/web add @aws-sdk/s3-request-presigner@3.899.0
      - pnpm install --frozen-lockfile
      - pnpm -w prisma generate --schema packages/db/schema.prisma
      - pnpm -C apps/web build

run:
  # üëâ Next ‡§ï‡•ã ‡§∏‡•Ä‡§ß‡•á apps/web ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü-‡§°‡§ø‡§∞ ‡§∏‡•á ‡§∏‡•ç‡§ü‡§æ‡§∞‡•ç‡§ü ‡§ï‡§∞‡§æ‡§ì (‡§ï‡•ã‡§à `cd` ‡§®‡§π‡•Ä‡§Ç)
  command: node apps/web/node_modules/next/dist/bin/next start apps/web -p 3000 --hostname 0.0.0.0
  network:
    port: 3000   # App Runner ‡§á‡§∏ ‡§™‡•ã‡§∞‡•ç‡§ü ‡§™‡§∞ ‡§ü‡•ç‡§∞‡•à‡§´‡§º‡§ø‡§ï ‡§≠‡•á‡§ú‡•á‡§ó‡§æ
  env:
    - name: NODE_ENV
      value: "production"
    - name: NEXT_TELEMETRY_DISABLED
      value: "1"
    - name: NEXTAUTH_URL
      value: "https://irw3nuvwzf.us-east-1.awsapprunner.com"  # ‡§Ö‡§≠‡•Ä ‡§ï‡•á Service URL ‡§∏‡•á ‡§Æ‡•à‡§ö ‡§∞‡§ñ‡•á‡§Ç
  secrets:
    - name: DATABASE_URL
      value-from: "arn:aws:secretsmanager:us-east-1:320819924019:secret:nebolla/DATABASE_URL-2QL4xa"
    - name: NEXTAUTH_SECRET
      value-from: "arn:aws:secretsmanager:us-east-1:320819924019:secret:nebolla/NEXTAUTH_SECRET-9jHrOL"
